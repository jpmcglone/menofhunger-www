@import "tailwindcss";
@import "@nuxt/ui";
@import "vue-advanced-cropper/dist/style.css";

/* Typography baseline (X-like): modern system font, readable sizing, nice rendering */
:root {
  /* Inter first, then system fallbacks (fast + consistent). */
  --moh-font-sans: Inter, ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica,
    Arial, "Apple Color Emoji", "Segoe UI Emoji";

  /* Safe-area + mobile layout constants (used across fixed UI). */
  /* Viewport height helper: avoids iOS `100vh` quirks in standalone/app-like contexts. */
  --moh-viewport-h: 100vh;
  --moh-safe-top: env(safe-area-inset-top, 0px);
  --moh-safe-right: env(safe-area-inset-right, 0px);
  /*
    Some iOS devices (notably newer curved-bottom iPhones) can report `env(safe-area-inset-bottom)=0`
    unless `viewport-fit=cover` is used. We intentionally *don't* use viewport-fit=cover (see nuxt.config.ts),
    so add a small minimum bottom inset for fixed bottom UI (tab bar, FAB, radio bar stacking).
  */
  --moh-safe-bottom: max(env(safe-area-inset-bottom, 0px), 12px);
  --moh-safe-left: env(safe-area-inset-left, 0px);
  --moh-tabbar-height: 4.5rem;
  --moh-radio-bar-height: 4rem;

  /* App-wide gutters (single source of truth for horizontal padding) */
  --moh-gutter-x: 1rem;

  /* Layout sizing */
  --moh-right-rail-w: 20rem;
}

@supports (height: 100dvh) {
  :root {
    --moh-viewport-h: 100dvh;
  }
}

html {
  font-family: var(--moh-font-sans);
  font-size: 16px;
  line-height: 1.45;
  font-kerning: normal;
  font-optical-sizing: auto;
  -webkit-text-size-adjust: 100%;
  text-rendering: optimizeLegibility;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

body {
  font-family: inherit;
}

html,
body {
  /* iOS Safari overscroll uses the page background; force this to win. */
  background-color: var(--moh-bg) !important;
  /* Prevent tiny horizontal overflow causing sideways "panning" on mobile. */
  overflow-x: hidden;
  overscroll-behavior-x: none;
}

html.dark,
html.dark body {
  background-color: var(--moh-bg);
}

/* Micro-texture: fine grain (1–2%) — machined, not grunge */
.moh-texture {
  position: relative;
}
.moh-texture::before {
  content: "";
  position: absolute;
  inset: 0;
  pointer-events: none;
  opacity: 0.015;
  background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)'/%3E%3C/svg%3E");
}
html.dark .moh-texture::before {
  opacity: 0.02;
}

/* App color tokens (X-like neutrals). Keep these as CSS variables so every surface stays consistent. */
:root {
  /* Warm neutrals (\"private study\" vibe) */
  /* Surface levels */
  --moh-surface-0: #fbfaf7; /* page bg (bone) */
  --moh-surface-1: #f2f0ea; /* primary surface (warm paper) */
  --moh-surface-2: #ffffff; /* elevated card surface */
  --moh-surface-3: #ffffff; /* popovers/dialogs */

  /* Back-compat aliases (used throughout the app) */
  --moh-bg: var(--moh-surface-0);
  --moh-surface: var(--moh-surface-1);
  --moh-surface-hover: #ebe7df; /* warm hover */

  /* Borders */
  --moh-border-subtle: #eee9e1;
  --moh-border: #e6e1d8; /* warm divider (alias) */
  --moh-border-strong: #d7cfc3;

  /* Text */
  --moh-text: #141210; /* warm near-black */
  --moh-text-muted: #5f5a55; /* warm muted */
  --moh-text-soft: #7a746e; /* tertiary */

  /* Focus (AA-visible) */
  --moh-focus-ring: rgba(20, 18, 16, 0.26);
  --moh-focus-ring-strong: rgba(20, 18, 16, 0.44);

  /* Shadows (light mode only; dark uses borders) */
  --moh-shadow-1: 0 1px 1px rgba(20, 18, 16, 0.04), 0 8px 24px rgba(20, 18, 16, 0.06);
  --moh-shadow-2: 0 2px 2px rgba(20, 18, 16, 0.06), 0 18px 46px rgba(20, 18, 16, 0.10);

  /* Frosted surfaces (used for sticky title bars) */
  --moh-frosted: rgba(242, 240, 234, 0.88);

  /* Typography */
  --moh-font-serif: Literata, ui-serif, Georgia, Cambria, "Times New Roman", Times, serif;

  /* Small UI surfaces */
  --moh-tooltip-bg: #141210;
  --moh-tooltip-text: #fbfaf7;

  /* Semantic accents (calmer, less "social app"-coded) */
  --moh-verified: #2b7bb9;
  --moh-verified-rgb: 43, 123, 185;
  --moh-verified-ring: rgba(43, 123, 185, 0.38);
  --moh-verified-soft: rgba(43, 123, 185, 0.12);

  --moh-premium: #c77d1a;
  --moh-premium-rgb: 199, 125, 26;
  --moh-premium-ring: rgba(199, 125, 26, 0.34);
  --moh-premium-soft: rgba(199, 125, 26, 0.12);

  /* Organization accent (silver, low-contrast) */
  --moh-org: #8a93a3;
  --moh-org-rgb: 138, 147, 163;
  --moh-org-ring: rgba(138, 147, 163, 0.32);
  --moh-org-soft: rgba(138, 147, 163, 0.12);

  --moh-onlyme: #6b4fd3;
  --moh-onlyme-rgb: 107, 79, 211;
  --moh-onlyme-ring: rgba(107, 79, 211, 0.34);
  --moh-onlyme-soft: rgba(107, 79, 211, 0.12);
}

html.dark {
  /* Serious, machined palette — not cozy */
  /* Surface levels */
  --moh-surface-0: #0F1113; /* page bg (charcoal) */
  --moh-surface-1: #14181C; /* primary surface */
  --moh-surface-2: #1B2127; /* elevated card surface */
  --moh-surface-3: #232B33; /* popovers/dialogs */

  /* Back-compat aliases */
  --moh-bg: var(--moh-surface-0);
  --moh-surface: var(--moh-surface-1);
  --moh-surface-hover: rgba(255, 255, 255, 0.05);

  /* Borders: opacity-based to stay consistent across surfaces */
  --moh-border-subtle: rgba(255, 255, 255, 0.08);
  --moh-border: rgba(255, 255, 255, 0.10);
  --moh-border-strong: rgba(255, 255, 255, 0.16);

  /* Text */
  --moh-text: #f4f4f5; /* Slightly brighter body for confidence */
  --moh-text-muted: #A3AAB4; /* metadata */
  --moh-text-soft: #7f8792; /* tertiary */

  /* Focus (AA-visible) */
  --moh-focus-ring: rgba(244, 244, 245, 0.24);
  --moh-focus-ring-strong: rgba(244, 244, 245, 0.38);

  /* Shadows: keep minimal in dark (borders do the work) */
  --moh-shadow-1: none;
  --moh-shadow-2: none;

  --moh-frosted: rgba(20, 24, 28, 0.92);

  --moh-tooltip-bg: rgba(15, 17, 19, 0.96);
  --moh-tooltip-text: #f4f4f5;

  /* Organization accent (silver, low-contrast) */
  --moh-org: #b9c0cc;
  --moh-org-rgb: 185, 192, 204;
  --moh-org-ring: rgba(185, 192, 204, 0.22);
  --moh-org-soft: rgba(185, 192, 204, 0.10);
}

/* NOTE: Do NOT remap premium → org based on the viewer.
   Premium orange must remain stable so "premium" UI reflects the target (post/user),
   not the currently logged-in viewer's account type. */

/* Apple-style continuous corners (squircle). Fallback: browsers ignore corner-shape, keep border-radius. */
@layer utilities {
  /* Mobile tap affordances: faster taps + no highlight flash. */
  .moh-tap {
    touch-action: manipulation;
    -webkit-tap-highlight-color: transparent;
  }

  .moh-gutter-x {
    padding-left: var(--moh-gutter-x);
    padding-right: var(--moh-gutter-x);
  }

  /* Shared active row highlight for split-pane section lists (settings/admin/chat). */
  .moh-pane-row-active {
    background-color: var(--moh-surface-hover);
  }

  /* Typography roles (bolder hierarchy, still compact like X) */
  .moh-h1 {
    font-size: 1.25rem;
    line-height: 1.15;
    font-weight: 800;
    letter-spacing: -0.015em;
    color: var(--moh-text);
  }
  .moh-h2 {
    font-size: 1.05rem;
    line-height: 1.2;
    font-weight: 800;
    letter-spacing: -0.01em;
    color: var(--moh-text);
  }
  .moh-body {
    font-size: 0.95rem;
    line-height: 1.45;
    color: var(--moh-text);
  }
  .moh-meta {
    font-size: 0.8125rem;
    line-height: 1.25;
    color: var(--moh-text-muted);
  }
  .moh-meta-strong {
    font-size: 0.8125rem;
    line-height: 1.25;
    font-weight: 650;
    color: var(--moh-text-muted);
  }

  .moh-squircle {
    corner-shape: squircle;
  }

  /* Pause icon on listener avatars: plain icon, white with shadow for readability on photos */
  .moh-avatar-pause .pi {
    color: #fff;
    font-size: 14px;
    filter: drop-shadow(0 0 2px rgba(0, 0, 0, 1)) drop-shadow(0 1px 3px rgba(0, 0, 0, 0.85));
  }
  .moh-avatar-pause-sm .pi {
    font-size: 12px;
  }

  /* Fade in/out when pause overlay appears or disappears on avatar */
  .moh-avatar-pause-fade-enter-active,
  .moh-avatar-pause-fade-leave-active {
    transition: opacity 0.18s ease;
  }
  .moh-avatar-pause-fade-enter-from,
  .moh-avatar-pause-fade-leave-to {
    opacity: 0;
  }

  @media (prefers-reduced-motion: reduce) {
    .moh-avatar-pause-fade-enter-active,
    .moh-avatar-pause-fade-leave-active {
      transition: none;
    }
  }

  .moh-bg {
    background-color: var(--moh-bg);
  }
  .moh-surface {
    background-color: var(--moh-surface);
  }
  .moh-surface-0 {
    background-color: var(--moh-surface-0);
  }
  .moh-surface-1 {
    background-color: var(--moh-surface-1);
  }
  .moh-surface-2 {
    background-color: var(--moh-surface-2);
  }
  .moh-surface-3 {
    background-color: var(--moh-surface-3);
  }
  .moh-surface-hover:hover {
    background-color: var(--moh-surface-hover);
  }

  /* Post row hover: white layer, 0 by default, opacity up on hover (light = darken, dark = lighten) */
  .moh-post-row-hover-bg {
    background-color: #fff;
    opacity: 0;
    transition: opacity 0.2s ease;
  }
  .group:hover .moh-post-row-hover-bg {
    opacity: 0.5;
  }
  html.dark .group:hover .moh-post-row-hover-bg {
    opacity: 0.14;
  }
  .moh-border {
    border-color: var(--moh-border);
  }
  .moh-border-subtle {
    border-color: var(--moh-border-subtle);
  }
  .moh-border-strong {
    border-color: var(--moh-border-strong);
  }
  .moh-text {
    color: var(--moh-text);
  }
  .moh-text-muted {
    color: var(--moh-text-muted);
  }
  .moh-text-soft {
    color: var(--moh-text-soft);
  }
  .moh-frosted {
    background-color: var(--moh-frosted);
  }

  /* Cohesive “card” + “popover” surfaces */
  .moh-card {
    background-color: var(--moh-surface-2);
    border: 1px solid var(--moh-border-subtle);
    box-shadow: var(--moh-shadow-1);
  }
  html.dark .moh-card {
    box-shadow: none;
  }
  .moh-popover {
    background-color: var(--moh-surface-3);
    border: 1px solid var(--moh-border-subtle);
    box-shadow: var(--moh-shadow-2);
  }
  html.dark .moh-popover {
    box-shadow: none;
  }

  /* AA-visible focus ring (use on interactive elements) */
  .moh-focus:focus-visible {
    outline: 2px solid var(--moh-focus-ring);
    outline-offset: 2px;
  }
  .moh-focus-strong:focus-visible {
    outline: 2px solid var(--moh-focus-ring-strong);
    outline-offset: 2px;
  }

  .moh-typing-bar {
    position: relative;
    overflow: hidden;
  }
  .moh-typing-bar::before {
    content: "";
    position: absolute;
    inset: 0;
    pointer-events: none;
    opacity: 1;
    transition: opacity 200ms ease;
    background-image: repeating-linear-gradient(
      135deg,
      rgba(0, 0, 0, 0.02) 0,
      rgba(0, 0, 0, 0.02) 3px,
      rgba(0, 0, 0, 0) 3px,
      rgba(0, 0, 0, 0) 9px
    );
  }
  html.dark .moh-typing-bar {
  }
  html.dark .moh-typing-bar::before {
    background-image: repeating-linear-gradient(
      135deg,
      rgba(255, 255, 255, 0.03) 0,
      rgba(255, 255, 255, 0.03) 3px,
      rgba(255, 255, 255, 0) 3px,
      rgba(255, 255, 255, 0) 9px
    );
  }
  .moh-typing-bar.moh-typing-bar--active::before {
    opacity: 0;
  }

  .moh-title {
    /* Use the same display font as profile names (sans). */
    font-family: var(--moh-font-sans);
    letter-spacing: -0.01em;
  }

  /* Theme-tinted pill (uses current app primary tokens). */
  .moh-pill-primary {
    /* Fallback: solid fill */
    background-color: var(--p-primary-color, #111827);
    color: var(--p-primary-contrast-color, #ffffff);
  }

  /* Notification badge: solid colors. Text: black in dark mode, white in light mode. */
  .moh-notif-badge-verified {
    background-color: var(--moh-verified);
    color: #ffffff;
  }
  .moh-notif-badge-premium {
    background-color: #e08b1a;
    color: #ffffff;
  }
  .moh-notif-badge-normal {
    background-color: #0f1113;
    color: #ffffff;
  }
  html.dark .moh-notif-badge-verified,
  html.dark .moh-notif-badge-premium,
  html.dark .moh-notif-badge-normal {
    color: #0f1113;
  }
  html.dark .moh-notif-badge-normal {
    background-color: #ffffff;
  }

  /* Visibility + tone utilities (avoid Tailwind sky/amber/violet drift) */
  .moh-pill-all-active {
    border-color: var(--moh-text);
    background-color: var(--moh-text);
    color: var(--moh-bg);
  }
  .moh-pill-all {
    border-color: var(--moh-border);
    color: var(--moh-text-muted);
  }
  .moh-pill-public-active {
    border-color: var(--moh-border);
    background-color: var(--moh-surface);
    color: var(--moh-text);
  }
  .moh-pill-public {
    border-color: var(--moh-border);
    color: var(--moh-text-muted);
  }

  .moh-pill-verified-active {
    border-color: var(--moh-verified);
    background-color: var(--moh-verified);
    color: #ffffff;
  }
  .moh-pill-verified {
    border-color: rgba(var(--moh-verified-rgb), 0.45);
    color: var(--moh-verified);
  }

  .moh-pill-premium-active {
    border-color: var(--moh-premium);
    background-color: var(--moh-premium);
    color: #ffffff;
  }
  .moh-pill-premium {
    border-color: rgba(var(--moh-premium-rgb), 0.45);
    color: var(--moh-premium);
  }

  .moh-pill-onlyme-active {
    border-color: var(--moh-onlyme);
    background-color: var(--moh-onlyme);
    color: #ffffff;
  }
  .moh-pill-onlyme {
    border-color: rgba(var(--moh-onlyme-rgb), 0.45);
    color: var(--moh-onlyme);
  }

  /* Thread block (post + replies): tier-colored border. Also used for modals. */
  .moh-thread-verified {
    border-color: rgba(var(--moh-verified-rgb), 0.4);
  }
  .moh-thread-premium {
    border-color: rgba(var(--moh-premium-rgb), 0.4);
  }
  .moh-thread-onlyme {
    border-color: rgba(var(--moh-onlyme-rgb), 0.4);
  }

  /* Post row highlight (e.g. the post being viewed on /p/:id). Color matches post visibility, not viewer tier. */
  .moh-post-highlight {
    /* Public: neutral bar + tint so highlight does not inherit viewer's theme. */
    box-shadow: inset 3px 0 0 0 var(--moh-border);
    background-color: color-mix(in srgb, var(--moh-border) 12%, transparent);
  }
  html.dark .moh-post-highlight {
    background-color: color-mix(in srgb, var(--moh-border) 18%, transparent);
  }
  .moh-post-highlight-verified {
    box-shadow: inset 3px 0 0 0 var(--moh-verified);
    background-color: rgba(var(--moh-verified-rgb), 0.08);
  }
  html.dark .moh-post-highlight-verified {
    background-color: rgba(var(--moh-verified-rgb), 0.12);
  }
  .moh-post-highlight-premium {
    box-shadow: inset 3px 0 0 0 var(--moh-premium);
    background-color: rgba(var(--moh-premium-rgb), 0.08);
  }
  html.dark .moh-post-highlight-premium {
    background-color: rgba(var(--moh-premium-rgb), 0.12);
  }
  .moh-post-highlight-onlyme {
    box-shadow: inset 3px 0 0 0 var(--moh-onlyme);
    background-color: rgba(var(--moh-onlyme-rgb), 0.08);
  }
  html.dark .moh-post-highlight-onlyme {
    background-color: rgba(var(--moh-onlyme-rgb), 0.12);
  }

  .moh-tag-verified {
    border-color: rgba(var(--moh-verified-rgb), 0.35);
    background-color: rgba(var(--moh-verified-rgb), 0.10);
    color: var(--moh-verified);
  }
  .moh-tag-premium {
    border-color: rgba(var(--moh-premium-rgb), 0.35);
    background-color: rgba(var(--moh-premium-rgb), 0.10);
    color: var(--moh-premium);
  }
  .moh-tag-onlyme {
    border-color: rgba(var(--moh-onlyme-rgb), 0.35);
    background-color: rgba(var(--moh-onlyme-rgb), 0.10);
    color: var(--moh-onlyme);
  }

  .moh-menuitem-verified {
    color: var(--moh-verified);
  }
  .moh-menuitem-verified:hover {
    background-color: var(--moh-verified-soft);
    color: var(--moh-text);
  }
  .moh-menuitem-premium {
    color: var(--moh-premium);
  }
  .moh-menuitem-premium:hover {
    background-color: var(--moh-premium-soft);
    color: var(--moh-text);
  }
  .moh-menuitem-onlyme {
    color: var(--moh-onlyme);
  }
  .moh-menuitem-onlyme:hover {
    background-color: var(--moh-onlyme-soft);
    color: var(--moh-text);
  }

  .moh-nav-onlyme {
    color: var(--moh-onlyme);
  }
  .moh-nav-onlyme:hover {
    background-color: var(--moh-onlyme-soft);
  }
  .moh-nav-onlyme-active {
    background-color: rgba(var(--moh-onlyme-rgb), 0.14);
    color: var(--moh-onlyme);
  }

  .moh-onlyme-icon {
    background-color: rgba(var(--moh-onlyme-rgb), 0.14);
    color: var(--moh-onlyme);
  }

  .moh-btn-tone {
    transition: opacity 140ms ease;
  }
  .moh-btn-tone:hover {
    opacity: 0.93;
  }

  .moh-btn-public {
    border-color: var(--moh-border) !important;
    background-color: transparent !important;
    color: var(--moh-text) !important;
  }
  .moh-btn-public:hover {
    background-color: var(--moh-surface-hover) !important;
  }

  .moh-btn-verified {
    border-color: var(--moh-verified) !important;
    background-color: var(--moh-verified) !important;
    color: #ffffff !important;
  }
  .moh-btn-premium {
    border-color: var(--moh-premium) !important;
    background-color: var(--moh-premium) !important;
    color: #ffffff !important;
  }
  .moh-btn-onlyme {
    border-color: var(--moh-onlyme) !important;
    background-color: var(--moh-onlyme) !important;
    color: #ffffff !important;
  }

  /* Matte depth: inner shadow instead of glossy highlights */
  .moh-card-matte {
    box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.06);
  }
  html.dark .moh-card-matte {
    box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.25);
  }
}

@supports (color: color-mix(in srgb, #000 50%, #fff)) {
  @layer utilities {
    /* Softer notification badge (still tied to current tint). */
    .moh-pill-primary {
      background-color: color-mix(in srgb, var(--p-primary-color, #111827) 22%, transparent);
      border: 1px solid color-mix(in srgb, var(--p-primary-color, #111827) 55%, transparent);
      color: var(--p-primary-color, #111827);
    }
  }
}

/* Hide scrollbars (keep scroll functional) */
.no-scrollbar {
  -ms-overflow-style: none; /* IE/old Edge */
  scrollbar-width: none; /* Firefox */
  /* Momentum scrolling + rubber-band on iOS (where allowed) */
  -webkit-overflow-scrolling: touch;
}
.no-scrollbar::-webkit-scrollbar {
  display: none; /* Chrome/Safari */
  width: 0;
  height: 0;
}

/* Simple fade transition (Vue <Transition name="moh-fade">) */
.moh-fade-enter-active,
.moh-fade-leave-active {
  transition: opacity 160ms ease, transform 160ms ease;
}
.moh-fade-enter-from,
.moh-fade-leave-to {
  opacity: 0;
  transform: translateY(2px);
}
.moh-fade-enter-to,
.moh-fade-leave-from {
  opacity: 1;
  transform: translateY(0);
}

/* Chat list enter/leave + FLIP move (Vue <TransitionGroup name="moh-chat-list">) */
.moh-chat-list-enter-active,
.moh-chat-list-leave-active {
  /* Avoid double-transform with `.moh-chat-item-enter` (new messages) and scroll-to-bottom. */
  transition: opacity 180ms ease;
}
.moh-chat-list-enter-from,
.moh-chat-list-leave-to {
  opacity: 0;
  transform: none;
}
.moh-chat-list-move {
  transition: transform 200ms ease;
}

/* Chat conversation list enter/leave + FLIP move (Vue <TransitionGroup name="moh-chat-row">) */
.moh-chat-row-enter-active,
.moh-chat-row-leave-active {
  transition: opacity 180ms ease, transform 180ms ease;
}
.moh-chat-row-enter-from,
.moh-chat-row-leave-to {
  opacity: 0;
  transform: translateY(6px);
}
.moh-chat-row-move {
  transition: transform 220ms ease;
}

/* Extra reliability: explicitly animate newly-added chat rows. */
.moh-chat-item-enter {
  animation: moh-chat-item-enter 220ms ease-out both;
}
@keyframes moh-chat-item-enter {
  from {
    opacity: 0;
    transform: translateY(8px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}
@media (prefers-reduced-motion: reduce) {
  .moh-chat-item-enter {
    animation: none;
  }
}

/* PrimeVue tooltip (used by verified badge): simple black + small white text */
.p-tooltip.moh-tooltip .p-tooltip-text {
  background: var(--moh-tooltip-bg) !important;
  color: var(--moh-tooltip-text) !important;
  font-size: 11px;
  line-height: 1.2;
  padding: 6px 8px;
  border-radius: 10px;
}
.p-tooltip.moh-tooltip .p-tooltip-arrow {
  /* Hide arrow to avoid the little square artifact */
  display: none !important;
}

/* Extra-small tooltip (X-like) for action icons */
.p-tooltip.moh-tooltip-tiny .p-tooltip-text {
  background: var(--moh-tooltip-bg) !important;
  color: var(--moh-tooltip-text) !important;
  font-size: 10px;
  line-height: 1.1;
  padding: 5px 7px;
  border-radius: 10px;
}
.p-tooltip.moh-tooltip-tiny .p-tooltip-arrow {
  /* Hide arrow to avoid the little square artifact */
  display: none !important;
}

/* Home composer textarea focus tint (PrimeVue Textarea uses focus ring tokens that don't fully follow primary) */
:where(.moh-composer-accent-verified) :where(.p-inputtextarea, textarea.p-inputtextarea):is(:focus, .p-focus) {
  border-color: var(--moh-verified) !important;
  box-shadow: 0 0 0 1px var(--moh-verified-ring) !important;
}
:where(.moh-composer-accent-premium) :where(.p-inputtextarea, textarea.p-inputtextarea):is(:focus, .p-focus) {
  border-color: var(--moh-premium) !important;
  box-shadow: 0 0 0 1px var(--moh-premium-ring) !important;
}
html.dark :where(.moh-composer-accent-public) :where(.p-inputtextarea, textarea.p-inputtextarea):is(:focus, .p-focus) {
  border-color: rgba(255, 255, 255, 0.75) !important;
  box-shadow: 0 0 0 1px rgba(255, 255, 255, 0.35) !important;
}
html:not(.dark) :where(.moh-composer-accent-public) :where(.p-inputtextarea, textarea.p-inputtextarea):is(:focus, .p-focus) {
  border-color: rgba(0, 0, 0, 0.75) !important;
  box-shadow: 0 0 0 1px rgba(0, 0, 0, 0.25) !important;
}

/* Home composer: custom textarea with animated focus tint */
.moh-composer-textarea {
  /* Remove browser-native styling (esp. Safari/iOS) */
  appearance: none;
  -webkit-appearance: none;
  outline: none;
  box-shadow: none;
  transition: border-color 180ms ease, box-shadow 180ms ease;
}
.moh-composer-textarea:is(:focus, :focus-visible) {
  outline: none;
  border-color: var(--moh-compose-accent);
  box-shadow: 0 0 0 1px var(--moh-compose-ring);
}

/* Chat DM composer (mobile IME reliability)
   Some Android Chromium variants (incl. Brave) can render IME "composing text" using
   `-webkit-text-fill-color` (defaulting to black) instead of `color` for a frame.
   Pin both so swipe-typing stays readable in dark mode. */
.dm-composer-input {
  color: var(--moh-text);
  -webkit-text-fill-color: var(--moh-text);
  caret-color: var(--moh-text);
}

/* Avatar fallback initial (bold + thick stroke) */
.moh-avatar-initial {
  font-weight: 800;
  letter-spacing: -0.02em;
  paint-order: stroke fill;
  font-size: var(--moh-avatar-font-size, inherit);
  -webkit-text-stroke-width: var(--moh-avatar-stroke-width, 3px);
}
html:not(.dark) .moh-avatar-initial {
  color: var(--moh-text);
  -webkit-text-stroke-color: var(--moh-bg);
}
html.dark .moh-avatar-initial {
  color: var(--moh-text);
  -webkit-text-stroke-color: var(--moh-bg);
}

/* @mention links in post body: use app primary tint. */
.moh-mention-link {
  color: var(--p-primary-color, var(--moh-text));
}
.moh-mention-link:hover {
  color: var(--p-primary-color, var(--moh-text));
  opacity: 0.85;
}

/* Post list transitions: delete immediately, others slide into place (FLIP). */
.moh-post-move {
  transition: transform 220ms ease;
}
.moh-post-enter-active,
.moh-post-leave-active {
  transition: opacity 160ms ease, transform 220ms ease;
}
.moh-post-enter-from {
  opacity: 0;
  transform: translateY(6px);
}
.moh-post-leave-to {
  opacity: 0;
  transform: translateY(-6px);
}
/* Let the remaining rows move immediately while the removed one fades out. */
.moh-post-leave-active {
  position: absolute;
  left: 0;
  right: 0;
}