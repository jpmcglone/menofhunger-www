@import "tailwindcss";
@import "@nuxt/ui";

/* Typography baseline (X-like): modern system font, readable sizing, nice rendering */
:root {
  /* Inter first, then system fallbacks (fast + consistent). */
  --moh-font-sans: Inter, ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica,
    Arial, "Apple Color Emoji", "Segoe UI Emoji";
}

html {
  font-family: var(--moh-font-sans);
  font-size: 16px;
  line-height: 1.45;
  font-kerning: normal;
  font-optical-sizing: auto;
  -webkit-text-size-adjust: 100%;
  text-rendering: optimizeLegibility;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

body {
  font-family: inherit;
}

html,
body {
  background-color: var(--moh-bg);
  /* Prevent tiny horizontal overflow causing sideways "panning" on mobile. */
  overflow-x: hidden;
  overscroll-behavior-x: none;
}

html.dark,
html.dark body {
  background-color: var(--moh-bg);
}

/* Micro-texture: fine grain (1–2%) — machined, not grunge */
.moh-texture {
  position: relative;
}
.moh-texture::before {
  content: "";
  position: absolute;
  inset: 0;
  pointer-events: none;
  opacity: 0.015;
  background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)'/%3E%3C/svg%3E");
}
html.dark .moh-texture::before {
  opacity: 0.02;
}

/* App color tokens (X-like neutrals). Keep these as CSS variables so every surface stays consistent. */
:root {
  /* Warm neutrals (\"private study\" vibe) */
  --moh-bg: #fbfaf7; /* bone */
  --moh-surface: #f2f0ea; /* warm paper */
  --moh-surface-hover: #ebe7df; /* warm hover */
  --moh-border: #e6e1d8; /* warm divider */
  --moh-text: #141210; /* warm near-black */
  --moh-text-muted: #5f5a55; /* warm muted */
  --moh-frosted: rgba(251, 250, 247, 0.88);

  /* Typography */
  --moh-font-serif: Literata, ui-serif, Georgia, Cambria, "Times New Roman", Times, serif;

  /* Small UI surfaces */
  --moh-tooltip-bg: #141210;
  --moh-tooltip-text: #fbfaf7;

  /* Semantic accents (calmer, less "social app"-coded) */
  --moh-verified: #2b7bb9;
  --moh-verified-rgb: 43, 123, 185;
  --moh-verified-ring: rgba(43, 123, 185, 0.38);
  --moh-verified-soft: rgba(43, 123, 185, 0.12);

  --moh-premium: #c77d1a;
  --moh-premium-rgb: 199, 125, 26;
  --moh-premium-ring: rgba(199, 125, 26, 0.34);
  --moh-premium-soft: rgba(199, 125, 26, 0.12);

  --moh-onlyme: #6b4fd3;
  --moh-onlyme-rgb: 107, 79, 211;
  --moh-onlyme-ring: rgba(107, 79, 211, 0.34);
  --moh-onlyme-soft: rgba(107, 79, 211, 0.12);
}

html.dark {
  /* Serious, machined palette — not cozy */
  --moh-bg: #0F1113; /* Charcoal */
  --moh-surface: #2A2F35; /* Steel */
  --moh-surface-hover: rgba(255, 255, 255, 0.05);
  --moh-border: #2A2F35; /* Steel, aligned with surface */
  --moh-text: #f4f4f5; /* Slightly brighter body for confidence */
  --moh-text-muted: #8A9099; /* Slate — clearly dimmer metadata */
  --moh-frosted: rgba(15, 17, 19, 0.92);

  --moh-tooltip-bg: rgba(15, 17, 19, 0.96);
  --moh-tooltip-text: #f4f4f5;
}

/* Apple-style continuous corners (squircle). Fallback: browsers ignore corner-shape, keep border-radius. */
@layer utilities {
  .moh-squircle {
    corner-shape: squircle;
  }

  .moh-bg {
    background-color: var(--moh-bg);
  }
  .moh-surface {
    background-color: var(--moh-surface);
  }
  .moh-surface-hover:hover {
    background-color: var(--moh-surface-hover);
  }

  /* Post row hover: white layer, 0 by default, opacity up on hover (light = darken, dark = lighten) */
  .moh-post-row-hover-bg {
    background-color: #fff;
    opacity: 0;
    transition: opacity 0.2s ease;
  }
  .group:hover .moh-post-row-hover-bg {
    opacity: 0.5;
  }
  html.dark .group:hover .moh-post-row-hover-bg {
    opacity: 0.14;
  }
  .moh-border {
    border-color: var(--moh-border);
  }
  .moh-text {
    color: var(--moh-text);
  }
  .moh-text-muted {
    color: var(--moh-text-muted);
  }
  .moh-frosted {
    background-color: var(--moh-frosted);
  }

  .moh-typing-bar {
    position: relative;
    overflow: hidden;
  }
  .moh-typing-bar::before {
    content: "";
    position: absolute;
    inset: 0;
    pointer-events: none;
    opacity: 1;
    transition: opacity 200ms ease;
    background-image: repeating-linear-gradient(
      135deg,
      rgba(0, 0, 0, 0.02) 0,
      rgba(0, 0, 0, 0.02) 3px,
      rgba(0, 0, 0, 0) 3px,
      rgba(0, 0, 0, 0) 9px
    );
  }
  html.dark .moh-typing-bar {
  }
  html.dark .moh-typing-bar::before {
    background-image: repeating-linear-gradient(
      135deg,
      rgba(255, 255, 255, 0.03) 0,
      rgba(255, 255, 255, 0.03) 3px,
      rgba(255, 255, 255, 0) 3px,
      rgba(255, 255, 255, 0) 9px
    );
  }
  .moh-typing-bar.moh-typing-bar--active::before {
    opacity: 0;
  }

  .moh-title {
    font-family: var(--moh-font-serif);
    letter-spacing: -0.01em;
  }

  /* Theme-tinted pill (uses current app primary tokens). */
  .moh-pill-primary {
    /* Fallback: solid fill */
    background-color: var(--p-primary-color, #111827);
    color: var(--p-primary-contrast-color, #ffffff);
  }

  /* Notification badge: solid colors. Text: black in dark mode, white in light mode. */
  .moh-notif-badge-verified {
    background-color: var(--moh-verified);
    color: #ffffff;
  }
  .moh-notif-badge-premium {
    background-color: #e08b1a;
    color: #ffffff;
  }
  .moh-notif-badge-normal {
    background-color: #0f1113;
    color: #ffffff;
  }
  html.dark .moh-notif-badge-verified,
  html.dark .moh-notif-badge-premium,
  html.dark .moh-notif-badge-normal {
    color: #0f1113;
  }
  html.dark .moh-notif-badge-normal {
    background-color: #ffffff;
  }

  /* Visibility + tone utilities (avoid Tailwind sky/amber/violet drift) */
  .moh-pill-all-active {
    border-color: var(--moh-text);
    background-color: var(--moh-text);
    color: var(--moh-bg);
  }
  .moh-pill-all {
    border-color: var(--moh-border);
    color: var(--moh-text-muted);
  }
  .moh-pill-public-active {
    border-color: var(--moh-border);
    background-color: var(--moh-surface);
    color: var(--moh-text);
  }
  .moh-pill-public {
    border-color: var(--moh-border);
    color: var(--moh-text-muted);
  }

  .moh-pill-verified-active {
    border-color: var(--moh-verified);
    background-color: var(--moh-verified);
    color: #ffffff;
  }
  .moh-pill-verified {
    border-color: rgba(var(--moh-verified-rgb), 0.45);
    color: var(--moh-verified);
  }

  .moh-pill-premium-active {
    border-color: var(--moh-premium);
    background-color: var(--moh-premium);
    color: #ffffff;
  }
  .moh-pill-premium {
    border-color: rgba(var(--moh-premium-rgb), 0.45);
    color: var(--moh-premium);
  }

  .moh-pill-onlyme-active {
    border-color: var(--moh-onlyme);
    background-color: var(--moh-onlyme);
    color: #ffffff;
  }
  .moh-pill-onlyme {
    border-color: rgba(var(--moh-onlyme-rgb), 0.45);
    color: var(--moh-onlyme);
  }

  /* Thread block (post + replies): tier-colored border. Also used for modals. */
  .moh-thread-verified {
    border-color: rgba(var(--moh-verified-rgb), 0.4);
  }
  .moh-thread-premium {
    border-color: rgba(var(--moh-premium-rgb), 0.4);
  }
  .moh-thread-onlyme {
    border-color: rgba(var(--moh-onlyme-rgb), 0.4);
  }

  /* Post row highlight (e.g. the post being viewed on /p/:id). Color matches post visibility, not viewer tier. */
  .moh-post-highlight {
    /* Public: neutral bar + tint so highlight does not inherit viewer's theme. */
    box-shadow: inset 3px 0 0 0 var(--moh-border);
    background-color: color-mix(in srgb, var(--moh-border) 12%, transparent);
  }
  html.dark .moh-post-highlight {
    background-color: color-mix(in srgb, var(--moh-border) 18%, transparent);
  }
  .moh-post-highlight-verified {
    box-shadow: inset 3px 0 0 0 var(--moh-verified);
    background-color: rgba(var(--moh-verified-rgb), 0.08);
  }
  html.dark .moh-post-highlight-verified {
    background-color: rgba(var(--moh-verified-rgb), 0.12);
  }
  .moh-post-highlight-premium {
    box-shadow: inset 3px 0 0 0 var(--moh-premium);
    background-color: rgba(var(--moh-premium-rgb), 0.08);
  }
  html.dark .moh-post-highlight-premium {
    background-color: rgba(var(--moh-premium-rgb), 0.12);
  }
  .moh-post-highlight-onlyme {
    box-shadow: inset 3px 0 0 0 var(--moh-onlyme);
    background-color: rgba(var(--moh-onlyme-rgb), 0.08);
  }
  html.dark .moh-post-highlight-onlyme {
    background-color: rgba(var(--moh-onlyme-rgb), 0.12);
  }

  .moh-tag-verified {
    border-color: rgba(var(--moh-verified-rgb), 0.35);
    background-color: rgba(var(--moh-verified-rgb), 0.10);
    color: var(--moh-verified);
  }
  .moh-tag-premium {
    border-color: rgba(var(--moh-premium-rgb), 0.35);
    background-color: rgba(var(--moh-premium-rgb), 0.10);
    color: var(--moh-premium);
  }
  .moh-tag-onlyme {
    border-color: rgba(var(--moh-onlyme-rgb), 0.35);
    background-color: rgba(var(--moh-onlyme-rgb), 0.10);
    color: var(--moh-onlyme);
  }

  .moh-menuitem-verified {
    color: var(--moh-verified);
  }
  .moh-menuitem-verified:hover {
    background-color: var(--moh-verified-soft);
    color: var(--moh-text);
  }
  .moh-menuitem-premium {
    color: var(--moh-premium);
  }
  .moh-menuitem-premium:hover {
    background-color: var(--moh-premium-soft);
    color: var(--moh-text);
  }
  .moh-menuitem-onlyme {
    color: var(--moh-onlyme);
  }
  .moh-menuitem-onlyme:hover {
    background-color: var(--moh-onlyme-soft);
    color: var(--moh-text);
  }

  .moh-nav-onlyme {
    color: var(--moh-onlyme);
  }
  .moh-nav-onlyme:hover {
    background-color: var(--moh-onlyme-soft);
  }
  .moh-nav-onlyme-active {
    background-color: rgba(var(--moh-onlyme-rgb), 0.14);
    color: var(--moh-onlyme);
  }

  .moh-onlyme-icon {
    background-color: rgba(var(--moh-onlyme-rgb), 0.14);
    color: var(--moh-onlyme);
  }

  .moh-btn-tone {
    transition: opacity 140ms ease;
  }
  .moh-btn-tone:hover {
    opacity: 0.93;
  }

  .moh-btn-public {
    border-color: var(--moh-border) !important;
    background-color: transparent !important;
    color: var(--moh-text) !important;
  }
  .moh-btn-public:hover {
    background-color: var(--moh-surface-hover) !important;
  }

  .moh-btn-verified {
    border-color: var(--moh-verified) !important;
    background-color: var(--moh-verified) !important;
    color: #ffffff !important;
  }
  .moh-btn-premium {
    border-color: var(--moh-premium) !important;
    background-color: var(--moh-premium) !important;
    color: #ffffff !important;
  }
  .moh-btn-onlyme {
    border-color: var(--moh-onlyme) !important;
    background-color: var(--moh-onlyme) !important;
    color: #ffffff !important;
  }

  /* Matte depth: inner shadow instead of glossy highlights */
  .moh-card-matte {
    box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.06);
  }
  html.dark .moh-card-matte {
    box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.25);
  }
}

@supports (color: color-mix(in srgb, #000 50%, #fff)) {
  @layer utilities {
    /* Softer notification badge (still tied to current tint). */
    .moh-pill-primary {
      background-color: color-mix(in srgb, var(--p-primary-color, #111827) 22%, transparent);
      border: 1px solid color-mix(in srgb, var(--p-primary-color, #111827) 55%, transparent);
      color: var(--p-primary-color, #111827);
    }
  }
}

/* Hide scrollbars (keep scroll functional) */
.no-scrollbar {
  -ms-overflow-style: none; /* IE/old Edge */
  scrollbar-width: none; /* Firefox */
  /* Momentum scrolling + rubber-band on iOS (where allowed) */
  -webkit-overflow-scrolling: touch;
}
.no-scrollbar::-webkit-scrollbar {
  display: none; /* Chrome/Safari */
  width: 0;
  height: 0;
}

/* Simple fade transition (Vue <Transition name="moh-fade">) */
.moh-fade-enter-active,
.moh-fade-leave-active {
  transition: opacity 160ms ease, transform 160ms ease;
}
.moh-fade-enter-from,
.moh-fade-leave-to {
  opacity: 0;
  transform: translateY(2px);
}
.moh-fade-enter-to,
.moh-fade-leave-from {
  opacity: 1;
  transform: translateY(0);
}

/* Chat list enter/leave + FLIP move (Vue <TransitionGroup name="moh-chat-list">) */
.moh-chat-list-enter-active,
.moh-chat-list-leave-active {
  transition: opacity 180ms ease, transform 180ms ease;
}
.moh-chat-list-enter-from,
.moh-chat-list-leave-to {
  opacity: 0;
  transform: translateY(6px);
}
.moh-chat-list-move {
  transition: transform 200ms ease;
}

/* Extra reliability: explicitly animate newly-added chat rows. */
.moh-chat-item-enter {
  animation: moh-chat-item-enter 220ms ease-out both;
}
@keyframes moh-chat-item-enter {
  from {
    opacity: 0;
    transform: translateY(8px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}
@media (prefers-reduced-motion: reduce) {
  .moh-chat-item-enter {
    animation: none;
  }
}

/* PrimeVue tooltip (used by verified badge): simple black + small white text */
.p-tooltip.moh-tooltip .p-tooltip-text {
  background: var(--moh-tooltip-bg) !important;
  color: var(--moh-tooltip-text) !important;
  font-size: 11px;
  line-height: 1.2;
  padding: 6px 8px;
  border-radius: 10px;
}
.p-tooltip.moh-tooltip .p-tooltip-arrow {
  /* Hide arrow to avoid the little square artifact */
  display: none !important;
}

/* Extra-small tooltip (X-like) for action icons */
.p-tooltip.moh-tooltip-tiny .p-tooltip-text {
  background: var(--moh-tooltip-bg) !important;
  color: var(--moh-tooltip-text) !important;
  font-size: 10px;
  line-height: 1.1;
  padding: 5px 7px;
  border-radius: 10px;
}
.p-tooltip.moh-tooltip-tiny .p-tooltip-arrow {
  /* Hide arrow to avoid the little square artifact */
  display: none !important;
}

/* Home composer textarea focus tint (PrimeVue Textarea uses focus ring tokens that don't fully follow primary) */
:where(.moh-composer-accent-verified) :where(.p-inputtextarea, textarea.p-inputtextarea):is(:focus, .p-focus) {
  border-color: var(--moh-verified) !important;
  box-shadow: 0 0 0 1px var(--moh-verified-ring) !important;
}
:where(.moh-composer-accent-premium) :where(.p-inputtextarea, textarea.p-inputtextarea):is(:focus, .p-focus) {
  border-color: var(--moh-premium) !important;
  box-shadow: 0 0 0 1px var(--moh-premium-ring) !important;
}
html.dark :where(.moh-composer-accent-public) :where(.p-inputtextarea, textarea.p-inputtextarea):is(:focus, .p-focus) {
  border-color: rgba(255, 255, 255, 0.75) !important;
  box-shadow: 0 0 0 1px rgba(255, 255, 255, 0.35) !important;
}
html:not(.dark) :where(.moh-composer-accent-public) :where(.p-inputtextarea, textarea.p-inputtextarea):is(:focus, .p-focus) {
  border-color: rgba(0, 0, 0, 0.75) !important;
  box-shadow: 0 0 0 1px rgba(0, 0, 0, 0.25) !important;
}

/* Home composer: custom textarea with animated focus tint */
.moh-composer-textarea {
  /* Remove browser-native styling (esp. Safari/iOS) */
  appearance: none;
  -webkit-appearance: none;
  outline: none;
  box-shadow: none;
  transition: border-color 180ms ease, box-shadow 180ms ease;
}
.moh-composer-textarea:is(:focus, :focus-visible) {
  outline: none;
  border-color: var(--moh-compose-accent);
  box-shadow: 0 0 0 1px var(--moh-compose-ring);
}

/* Avatar fallback initial (bold + thick stroke) */
.moh-avatar-initial {
  font-weight: 800;
  letter-spacing: -0.02em;
  paint-order: stroke fill;
  font-size: var(--moh-avatar-font-size, inherit);
  -webkit-text-stroke-width: var(--moh-avatar-stroke-width, 3px);
}
html:not(.dark) .moh-avatar-initial {
  color: var(--moh-text);
  -webkit-text-stroke-color: var(--moh-bg);
}
html.dark .moh-avatar-initial {
  color: var(--moh-text);
  -webkit-text-stroke-color: var(--moh-bg);
}

/* @mention links in post body: use app primary tint. */
.moh-mention-link {
  color: var(--p-primary-color, var(--moh-text));
}
.moh-mention-link:hover {
  color: var(--p-primary-color, var(--moh-text));
  opacity: 0.85;
}

/* Post list transitions: delete immediately, others slide into place (FLIP). */
.moh-post-move {
  transition: transform 220ms ease;
}
.moh-post-enter-active,
.moh-post-leave-active {
  transition: opacity 160ms ease, transform 220ms ease;
}
.moh-post-enter-from {
  opacity: 0;
  transform: translateY(6px);
}
.moh-post-leave-to {
  opacity: 0;
  transform: translateY(-6px);
}
/* Let the remaining rows move immediately while the removed one fades out. */
.moh-post-leave-active {
  position: absolute;
  left: 0;
  right: 0;
}